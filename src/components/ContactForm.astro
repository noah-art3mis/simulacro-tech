---
---

<div class="w-full max-w-2xl mx-auto">
	<form
		id="contact-form"
		action="https://formspree.io/f/xpwvlovb"
		class="grid gap-y-6"
		target="_top"
		method="POST"
	>
		<div class="flex flex-col gap-y-1.5">
			<label
				class="block text-sm font-medium text-white"
				for="name"
			>
				Name
			</label>
			<input
				class="h-10 rounded-md border-0 px-3 bg-gray-900 text-white placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-white"
				id="name"
				name="name"
				type="text"
				required
			/>
		</div>

		<div class="flex flex-col gap-y-1.5">
			<label
				class="block text-sm font-medium text-white"
				for="email"
			>
				Email
			</label>
			<input
				class="h-10 rounded-md border-0 px-3 bg-gray-900 text-white placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-white"
				id="email"
				name="email"
				type="email"
				required
			/>
		</div>

		<div class="flex flex-col gap-y-1.5">
			<label
				class="block text-sm font-medium text-white"
				for="message"
			>
				Message
			</label>
			<textarea
				class="resize-none rounded-md border-0 px-3 py-2 bg-gray-900 text-white placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-white"
				id="message"
				name="message"
				rows="6"
				required
			></textarea>
		</div>

		<div class="flex flex-row-reverse gap-x-6">
			<button
				class="rounded-md bg-black px-8 py-4 text-sm font-medium text-white transition-colors hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-white"
				type="submit"
			>
				Send
			</button>
		</div>
	</form>

	<div id="error" class="text-sm text-red-600 hidden mt-6"></div>

	<div id="success" class="bg-gray-100 border border-black p-6 text-center hidden mt-6">
		<p class="text-lg font-semibold mb-2 text-black">Thank you for your message!</p>
		<p class="text-sm text-gray-800">We'll get back to you soon.</p>
		<button
			type="button"
			id="send-another"
			class="mt-4 text-sm underline hover:no-underline text-black"
		>
			Send another message
		</button>
	</div>
</div>

<script>
	const form = document.getElementById('contact-form') as HTMLFormElement;
	const errorDiv = document.getElementById('error');
	const successDiv = document.getElementById('success');
	const sendAnotherBtn = document.getElementById('send-another');

	if (form && errorDiv && successDiv && sendAnotherBtn) {
		form.addEventListener('submit', async (e) => {
			e.preventDefault();
			errorDiv.classList.add('hidden');
			successDiv.classList.add('hidden');

			const formData = new FormData(form);
			const name = formData.get('name') as string;
			const email = formData.get('email') as string;
			const message = formData.get('message') as string;

			if (!name || !email || !message) {
				errorDiv.textContent = 'Please fill in all fields.';
				errorDiv.classList.remove('hidden');
				return;
			}

			if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
				errorDiv.textContent = 'Please enter a valid email address.';
				errorDiv.classList.remove('hidden');
				return;
			}

			// Submit to Formspree
			try {
				const response = await fetch(form.action, {
					method: 'POST',
					body: formData,
					headers: {
						'Accept': 'application/json'
					}
				});

				// Formspree returns 200 on success with JSON, or 302 redirect
				if (response.ok) {
					// Check if response is JSON
					const contentType = response.headers.get('content-type');
					if (contentType && contentType.includes('application/json')) {
						const data = await response.json();
						// Formspree returns { next: "..." } or { ok: true } on success
						if (data.next || data.ok !== false) {
							form.classList.add('hidden');
							successDiv.classList.remove('hidden');
						} else {
							errorDiv.textContent = data.error || 'Something went wrong. Please try again.';
							errorDiv.classList.remove('hidden');
						}
					} else {
						// If not JSON, assume success (redirect response)
						form.classList.add('hidden');
						successDiv.classList.remove('hidden');
					}
				} else if (response.status === 302) {
					// Redirect means success for Formspree
					form.classList.add('hidden');
					successDiv.classList.remove('hidden');
				} else {
					// Try to parse error response
					try {
						const data = await response.json();
						errorDiv.textContent = data.error || 'Something went wrong. Please try again.';
					} catch {
						errorDiv.textContent = `Error: ${response.status} ${response.statusText}. Please try again.`;
					}
					errorDiv.classList.remove('hidden');
				}
			} catch (error) {
				console.error('Form submission error:', error);
				errorDiv.textContent = 'Network error. Please check your connection and try again.';
				errorDiv.classList.remove('hidden');
			}
		});

		sendAnotherBtn.addEventListener('click', () => {
			form.reset();
			form.classList.remove('hidden');
			successDiv.classList.add('hidden');
			errorDiv.classList.add('hidden');
		});
	}
</script>

